> CAP 정리는 분산 시스템의 특성을 설명하는 이론으로, 분산 시스템이 일관성(Consistency), 가용성(Availability), 그리고 파티션 허용성(Partition Tolerance)의 **세 가지 특성 중 동시에 두 가지 특성만 충족할 수 있다** 는 내용을 담고 있다. 이를 **CAP 이론** 또는 **CAP 정리**라고 부르며, 분산 시스템을 설계할 때 시스템이 어떤 특성에 집중할 것인지에 대해 중요한 기준을 제공한다.

### CAP 정리의 세 가지 요소는 다음과 같다.

- **일관성 (Consistency)**: 모든 노드가 같은 시점에 **동일한 데이터**를 보여주는 특성. 분산 시스템에서 데이터가 여러 노드에 저장될 때, 어느 노드에서 접근하더라도 같은 데이터를 읽을 수 있는 상태를 말한다.

- **가용성 (Availability)**: 모든 요청에 대해 응답할 수 있는 특성. 사용자가 데이터를 요청할 때 시스템은 **항상 응답을 보장**해야 하며, **데이터가 최신이 아닐 수는 있어도** 일단 응답이 이루어져야 한다.

- **파티션 허용성 (Partition Tolerance)**: 네트워크 파티션(네트워크 연결 단절)이 발생하더라도 시스템이 동작을 유지할 수 있는 특성. **네트워크 장애로 인해 노드 간 연결이 끊어지는 상황**에서도 시스템의 일부가 계속해서 정상적으로 작동할 수 있어야 한다.

### CAP 정리의 핵심
CAP 정리에 따르면, 네트워크가 파티션을 허용하는 상황(즉, 네트워크 장애가 발생할 수 있는 상황)에서 분산 시스템은 **일관성과 가용성 중 하나만을 최우선으로 선택해야 한다**. 세 가지를 모두 만족하는 것은 불가능하며, 분산 시스템 설계 시 두 가지 특성 중 어떤 것을 우선시할 것인지를 결정해야 한다.

1. **CP 시스템 (Consistency + Partition Tolerance)**: 일관성과 파티션 허용성을 보장하지만, 네트워크 파티션 상황에서는 일부 요청에 대해 응답하지 못할 수 있다. (예: HBase, MongoDB)
    - 노드 간 네트워크 통신이 끊기는 순간 노드 간 일관성이 보장되지 않기 때문에, 외부에서 들어오는 요청을 아예 차단해버림으로써 (오류 리턴 -> 서버장애 상황 -> 가용성 하락) 일관성이 보장되지 않는 데이터를 아예 조회할 수 없도록 한다.

2. **AP 시스템 (Availability + Partition Tolerance)**: 노드 간 통신이 끊겨도 가용성을 중시하여 외부의 요청을 받아들인다. 노드 간 통신이 끊긴 사이 일관성이 깨지는 것을 허용한다. 물론 나중에 노드 간 통신이 복구되었을 때 결국 동기화됨.(예: Cassandra, DynamoDB)

3. **CA 시스템 (Consistency + Availability)**: 이론적으로는 가능하나, 네트워크 파티션 상황을 고려하지 않는 경우에만 성립하며, 현실적으로 네트워크 장애를 배제할 수 없으므로 CA 시스템은 실제 분산 시스템에서는 구현하기 어렵다.

### CAP 정리의 실용적 적용
CAP 정리는 모든 분산 시스템 설계의 필수 고려 사항이다. 현대 시스템에서는 보통 **CAP 이론을 절대적인 한계가 아닌, 트레이드 오프를 고려한 설계 우선순위를 정하는 가이드라인**으로 삼는다. CAP 이론을 통해 각 애플리케이션의 요구에 맞는 시스템 특성을 선택하여 분산 시스템을 설계할 수 있다.

---
### CP 가 중요한 상황 (일관성 + 파티션 허용)
- 제품의 재고를 표시하여 구매 여부를 결정하는 경우. 제품이 한 개 남았는데, 노드 간 일관성을 유지하지 못해 제품이 품절된 사실을 다른 노드가 알지 못하면없는 제품에 대해 결제하는 사고가 발생할 수 있음
### AP 가 중요한 상황 (가용성 + 파티션 하용)
- 인스타 게시물 좋아요 수를 출력하는 경우. 노드 간 통신이 끊겨 동기화가 이뤄지지 않아 좋아요가 최신의 데이터를 반영하지 못한다해서 어플리케이션 사용에 치명적이지는 않음.  